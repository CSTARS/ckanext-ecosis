<link rel="import" href="../ui/esis-ui-metadata.html"/>

<polymer-element name="esis-join">
	<template>
    	<template repeat="{{metadata in metadataDatasheets}}">
    		<esis-ui-metadata metadata="{{metadata}}"></esis-ui-metadata>
    	</template>
	</template>
	<script>
		Polymer('esis-join', {
			datasheets : [],
			metadataDatasheets : [],

			menuItem : null,

			observe : {
				datasheets : '_update'
			},

			ready : function() {
				 window.addEventListener('polymer-ready', function(e) {
				 	this.async(function(){
				 		this.datasheets = document.querySelector('esis-datastore').datasheets;
				 	});
				}.bind(this));
			},

			_update : function() {
				this.async(function(){
					this.metadataDatasheets = [];

					for( var i = 0; i < this.datasheets.length; i++ ) {
						if( this.datasheets[i].isMetadata ) {
							this.metadataDatasheets.push(this.datasheets[i].metadata);
						}
					}

					this._updateVisibility();
				});
			},

			_updateVisibility : function() {
				var count = 0;
				for( var i = 0; i < this.metadataDatasheets.length; i++ ) {
					if( this.metadataDatasheets[i].joinId != '' ) count++;
				}

				if( this.metadataDatasheets.length > 0 ) {
					// how do we keep this in sync?
					//this.menuItem.setSecondaryHtml(count+' of '+this.metadataDatasheets.length+' sheets joined');
					this.menuItem.style.display = 'block';
				} else {
					this.menuItem.style.display = 'none';
				}
			}
		});
	</script>
</polymer-element>