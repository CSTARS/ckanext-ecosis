<link rel="import" href="../components/paper-dialog/paper-dialog.html">

<polymer-element name="esis-dataset-loader">
	<template>
		<paper-dialog id="dialog" transition="paper-transition-bottom" backdrop layered autoCloseDisabled>
			Loading Dataset...
		</paper-dialog>
	</template>
	<script>
		Polymer('esis-dataset-loader', {
			data : {},
			ds : {},

			ready : function() {
				var id = this._getVar('id');
				if( id == null ) return;

				this.ds = document.querySelector('esis-datastore');

				//this.$.dialog.toggle();
				window.addEventListener('polymer-ready', function(e) {
				var ckan = document.querySelector('esis-ckan');
				ckan.getPackage(id, function(err, pkg){
					if( err || pkg.error ) return alert('Error loading dataset.');

					this.data = pkg;
					this._setData();
					//this.$.dialog.toggle();
				}.bind(this));
				}.bind(this));
			},

			_setData : function() {
				this.ds.editMode = true;
				for( var key in this.ds.data ) {
					if( this.data[key] ) this.ds.data[key] = this.data[key];
				}
			},

			_getVar : function(variable) {
       			var query = window.location.search.substring(1);
       			var vars = query.split("&");
       			for (var i = 0; i < vars.length; i++) {
               		var pair = vars[i].split("=");
               		if( pair[0] == variable ) return pair[1];
       			}
       			return null;
			}
		});
	</script>
</polymer-element>