<link rel="import" href="../../components/paper-tabs/paper-tabs.html" />
<link rel="import" href="../ui/esis-ui-spectra.html" />
<link rel="import" href="../ui/esis-ui-datasheet.html" />

<polymer-element name="esis-parsed-spectra">
	<template>
		<style>
			paper-tabs::shadow #selectionBar {
				background-color: rgb(47, 155, 69);
			}
			paper-tab::shadow #ink {
				color: rgb(47, 155, 69);
			}
		</style>

    	<paper-tabs selected="{{selectedTab}}">
		    <paper-tab>Datasheet View</paper-tab>
		    <paper-tab>Spectra View</paper-tab>
		</paper-tabs>


		<div style="display: {{ selectedTab == 0 ? 'block' : 'none' }}">
			<template repeat="{{datasheet in datasheets}}">
				<esis-ui-datasheet datasheet="{{datasheet}}"></esis-ui-datasheet>
			</template>
		</div>
		<div style="display: {{ selectedTab == 1 ? 'block' : 'none' }}">
			<h2>{{spectra.length}} Spectra Found</h2>
			<div>
				<span class="label success-label">File Level Metadata</span> 
				<span class="label info-label">Spectra Level Metadata</span> 
				<span class="label warning-label">Linked Metadata</span> <br>
				<span style="color:#888;text-size:12px">* = Custom field, custom fields will still be stored, but if the field maps to an Ecosis Attribute, please fill out and upload a metadata map on the previous screen.</span>
			</div>

			<select id="spectraSelector" on-change="{{_selectSpectra}}">
				<template repeat="{{sp,i in spectra}}">
					<option value="{{i}}">{{i+1}}</option>
				</template>
			</select>

			<esis-ui-spectra id="spectraUI" spectra="{{selectedSpectra}}"></esis-ui-spectra>
		</div>

	</template>
	<script>
		Polymer('esis-parsed-spectra', {
			
			menuItem : null,

			selectedTab : 0,

			datasheets : [],
			spectra    : [],

			selectedSpectra : {},

			observe : {
				datasheets : '_update',
				selectedTab : '_onTabChange'
			},

			ready : function() {
				 window.addEventListener('polymer-ready', function(e) {
				 	this.async(function(){
				 		this.datasheets = document.querySelector('esis-datastore').datasheets;
				 	});
				}.bind(this));
			},

			_update : function() {
				this.async(function(){
					this.spectra = [];

					for( var i = 0; i < this.datasheets.length; i++ ) {
						var f = this.datasheets[i];
						for( var j = 0; j < f.spectra.length; j++ ) {
							this.spectra.push(f.spectra[j]);
						}
					}

					if( this.spectra.length > 0 ) {
						this.selectedSpectra = this.spectra[0];
					}

					this._updateVisibility();
					this.menuItem.setSecondaryHtml(this.spectra.length+' Spectra Found');
				});
			},

			_updateVisibility : function() {
				if( this.datasheets.length > 0 ) {
					this.menuItem.style.display = 'block';
				} else {
					this.menuItem.style.display = 'none';
				}
			},

			_onTabChange : function() {
				if( this.selectedTab == 1 ) this.$.spectraUI.show();
			},

			_selectSpectra : function() {
				this.selectedSpectra = this.spectra[parseInt(this.$.spectraSelector.value)];
			}

		});
	</script>
</polymer-element>