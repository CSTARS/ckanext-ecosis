<polymer-element name="esis-spectra">
	<template></template>
	<script>
		Polymer('esis-spectra', {
			data : [],

			filename : '',
			sheetname : '',

			error : null,
			ckanId : '',
			joinOrder : ['joined', 'file', 'spectra'],
			metadata : {},
			spectra_id : '',

			ready : function() {
				this.data = [];
				this.metadata = {
					spectra : {},
					file : {},
					joined : {}
				}
			},

			getAttributes : function() {
				var attrs = [], type, i, key;

				for( i = 0; i < this.joinOrder.length; i++ ) {
					type = this.metadata[this.joinOrder[i]];
					for( key in type ) {
						if( attrs.indexOf(key) == -1 ) attrs.push(key);
					}
				}

				return attrs;
			},

			// shortend so we don't colid on ns
			getMetadataAttr : function(attr) {
				for( var i = 0; i < this.joinOrder.length; i++ ) {
					if( this.metadata[this.joinOrder[i]][attr] ) {
						return this.metadata[this.joinOrder[i]][attr];
					}
				}
				return null;
			},

			mergeMetadata : function() {
				var md = {};
				for( var i = 0; i < this.joinOrder.length; i++ ) {
					for( var key in this.metadata[this.joinOrder[i]] ) {
						md[key] = this.metadata[this.joinOrder[i]][key];
					}
				}
				return md;
			},

			updateUid : function()  {
				var uid = document.querySelector('esis-datastore').spectraDisambiguator;

				var field = '';
				if( uid && uid.length > 0 ) {
					for( var i = 0; i < this.joinOrder.length; i++ ) {
						if( this.metadata[this.joinOrder[i]][field] ) {
							field = this.metadata[this.joinOrder[i]][field];
							break;
						}
					}
				}

				if( uid.length > 0 ) {
					this.spectra_id = md5(JSON.stringify(this.data)+field);
				} else {
					this.spectra_id = md5(JSON.stringify(this.data));
				}
			}

		});
	</script>
</polymer-element>