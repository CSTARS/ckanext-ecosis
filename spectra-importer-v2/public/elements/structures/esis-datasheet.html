<link rel="import" href="esis-metadata.html"/>
<link rel="import" href="esis-spectra.html"/>

<polymer-element name="esis-datasheet">
	<template></template>
	<script>
		Polymer('esis-datasheet',{
			// parent esis-file element
			file : {},

			// parsed datasheet contents
			contents : {},

			spectra : [],
			metadata : {},

			// we will try and detect this flag.  but let users select if we get it wrong
			isMetadata : false,

			label : '',

			observe : {
				file : '_update'
			},

			ready : function() {
				this.spectra = [];
				this.metadata = {};
				this.file = {};
			},

			_update : function() {
				this._setTitle();

				if( this.file.spectra && this.file.spectra.length > 0 ) {
					for( var i = 0; i < this.file.spectra.length; i++ ) {
						var sp = document.createElement('esis-spectra');
						sp.data = this.file.spectra[i].data;
						sp.metadata.spectra = this.file.spectra[i].metadata;
						sp.filename = this.file.info.name;
						sp.sheetname = this.file.sheetName;

						if( this.file.metadata ) {
							for( var key in this.file.metadata ) {
								sp.metadata.file[key] = this.file.metadata[key];
							}
						}
						this.spectra.push(sp);
					}
				} else if( this.file.joindata && this.file.joindata.length > 0 ) {
					this.metadata = document.createElement('esis-metadata');
					this.metadata.file = this.file;
					this.metadata.metadata = this.file.joindata;
					this.isMetadata = true;
				}

			},

			_setTitle : function() {
				var name = this.file.name || this.file.info.name;
				this.label = name.replace(/.*\//,'');
				if( this.file.sheetName && this.file.sheetName != '' ) this.label += ' - '+this.file.sheetName;
				if( this.label.length == 0 || this.label == ' ' ) this.label = name;
			}
		});
	</script>
</polymer-element>