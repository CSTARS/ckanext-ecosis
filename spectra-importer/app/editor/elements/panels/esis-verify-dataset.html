<polymer-element name="esis-verify-dataset">
	<template>
		<style>
			table {
				border-spacing: 0px;
				width: 100%;
			}
			table tr td {
				padding: 5px;
			}
			table tr td:nth-child(2) {
				color: #888;
			}
			table tr:nth-child(odd) {
				background-color: #f8f8f8;
			}
			h4 {
				color: #888;
			}
			h2 {
				color: #2f9b45;
			}
			.card {
				padding: 15px;
				margin: 15px;
				min-width: 350px;
			}
			.colored {
				background-color: #2f9b45;
				color: white;
			}
		</style>

		<h2>Push Changes to Ecosis Search</h2>
		<div>
			Please verify all information looks correct.  Once everything looks correct, click 'Push' below and your changes will be represented at <a href="http://ecospectra.org" target="_blank">ecospectra.org</a>.
		</div>

		<div class="card">
			<h4>Basic Information</h4>
			<table>
				<tr><td>Title</td><td>{{ds.data.title}}</td></tr>
				<tr><td>Name</td><td>{{ds.data.name}}</td></tr>
				<tr><td>Description</td><td>{{ds.data.notes}}</td></tr>
				<tr><td>License</td><td>{{ds.data.license_title}}</td></tr>
				<tr><td>Organization</td><td>{{ds.owner_org_name}}</td></tr>
				<tr><td>Visibility</td><td>{{ds.data.hidden ? 'Private' : 'Public'}}</td></tr>
				<tr><td>Version</td><td>{{ds.data.version}}</td></tr>
				<tr><td>Author</td><td><b>{{ds.data.author}}</b> <i>{{ds.data.author_email}}</i></td></tr>
				<tr><td>Maintainer</td><td><b>{{ds.data.maintainer}}</b> <i>{{ds.data.maintainer_email}}</i></td></tr>
			</table>
		</div>

		<div class="card">
			<h4>Resource Information</h4>
			<table>
				<tr><td>Total Resources</td><td>{{ds.resources.length}}</td></tr>
				<tr><td>Metadata Sheets</td><td>{{counts.metadataResources}}</td></tr>
				<tr><td>Spectra Sheets</td><td>{{counts.measurementResources}}</td></tr>
				<tr><td># Parsed Spectra</td><td>{{counts.measurements}}</td></tr>
			</table>
		</div>

		<paper-button style="float:right" on-tap="{{cancel}}">Cancel</paper-button>
		<paper-button raised class="colored" on-tap="{{finalize}}">Push</paper-button>


	</template>
	<script>
		Polymer('esis-verify-dataset', {
			ds : {},

			counts : {},

			observe : {
				'ds.resources' : 'updateCounts'
			},

			ready : function() {
				this.ds = document.querySelector('esis-datastore');
			},

			updateCounts : function() {
				this.counts = {
					metadataResources : 0,
					measurementResources : 0,
					measurements : 0
				}

				for( var i = 0; i < this.ds.resources.length; i++ ) {
					var resource = this.ds.resources[i];
					if( !resource.datasheets || resource.ignore ) continue;

					for( var j = 0; j < resource.datasheets.length; j++ ) {
						var datasheet = resource.datasheets[j];
						if( datasheet.ignore ) continue;

						if( datasheet.metadata ) {
							this.counts.metadataResources++;
						} else if ( datasheet.spectra_count ) {
							this.counts.measurementResources++;
							this.counts.measurements += datasheet.spectra_count;
						}
					}
				}
			},

			finalize : function(){
				this.fire('finalize');
			},
			cancel : function(){
				this.fire('cancel');
			}
		});
	</script>
</polymer-element>