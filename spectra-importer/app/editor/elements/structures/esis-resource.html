<polymer-element name="esis-resource">
	<template></template>
	<script>
		Polymer('esis-resource', {
			contents   : null,
			filename   : '',
			mimetype   : '',
			ext        : '',
			datasheets : [],
			title      : '',
			resourceId  : '',

			dataType : '',

			knownAttributes : {},

			observe : {
				filename : '_setTitle',
				datasheets : '_updateAttributes'
			},

			_setTitle : function() {
				this.title = this.filename.replace(/.*\//,'');
				if( this.title.length == 0 || this.title == ' ' ) this.title = this.filename;
			},

			setId : function(resourceId) {
				this.resourceId = resourceId;

                if( !this.datasheets ) return;
                
				for( var i = 0; i < this.datasheets.length; i++ ) {
					this.datasheets[i].setResourceId(resourceId);
				}
			},

			// update what attributes exist inside this resources datasheets and what we think they are
			_updateAttributes : function() {
                if( !this.datasheets ) return;

				for( var i = 0; i < this.datasheets.length; i++ ) {
				 	if( this.datasheets[i].measurements.length == 0 ) continue;

                    var m = this.datasheets[i].measurements[0];

                    for( var j = 0; j < m.data.length; j++ ) {
                    	this._addKnownAttribute(m.data[j].key, 'data');
                    }

                    for( var key in m.metadata ) {
                    	for( var mkey in m.metadata[key] ){
                    		this._addKnownAttribute(mkey, 'metadata');
                    	}	
                    }
                }
			},

			_addKnownAttribute : function(key, type) {
				if( !this.knownAttributes[key] ) {
                    this.knownAttributes[key] = type;
                }
			}

		});
	</script>
<polymer-element>