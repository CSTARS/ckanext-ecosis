<dom-module id="ecosis-page-basic-info">
  <style>
    :host {
      display: block;
      padding: 0 10%;
    }
  </style>
  <template>

    <div style="font-size: 14px; color: #888">
			<div style="color:#333; font-weight: bold; padding-bottom: 15px">Welcome <span id="usernameLabel"></span>.</div>
			Fill out the basic information for your dataset.  Then you can add resource files such as metadata or spectra.<br />
      First time adding data?  Checkout the <a href="http://tutorial.ecospectra.org/" target="_blank">screencast and tutorial.</a>
		</div>

    <!-- Title -->
		<div id="editModeTitle" style="display:none">
			<div><b>Title:</b> <span id="titleLabel"><span></div>
			<div style="font-size:12px;color:#888;font-style:italic">
				URL: <span id="urlLabel"></span>
			</div>
		</div>

    <div class="form-horizontal">

  		<div id="newDatasetTitle">
        <div class="form-group">
          <label for="titleInput" class="col-lg-2 control-label">Title</label>
          <div class="col-lg-10">
            <input type="text" class="form-control" id="titleInput" placeholder="Unique dataset title" on-change="onTitleInputChange">
          </div>
        </div>

        <div id="verifyingTitleLabel" class="alert alert-info" style="display:none">
  				<i class="fa fa-spinner fa-spin"></i> Verifying name...
  			</div>

  			<div class="alert alert-danger" style="display:none">
  				Invalid name.  A dataset with this name already exists.

          <br />URL: {{baseUrl}}<span style="color: {{validName ? '#2f9b45' : 'red'}}">{{ds.data.name}}</span>
  			</div>

  			<div class="alert alert-success" style="display:none" >
  				URL: <span id="urlLabel"></span>
  			</div>
  		</div>
      <!-- End Title -->


      <!-- Description -->
      <div class="form-group">
        <label for="textArea" class="col-lg-2 control-label">Description</label>
        <div class="col-lg-9">
          <textarea class="form-control" rows="3" id="descriptionInput" on-change="onDescriptionInputChange"></textarea>
        </div>
      </div>

      <div class="form-group">
        <label for="titleInput" class="col-lg-2 control-label">Keywords</label>
        <div class="col-lg-10">
          <input type="text" class="form-control" id="keywordsInput" on-change="onKeywordsInputChange">
        </div>
      </div>
      <!-- TODO
  		<div class="form-wrap">
  			<esis-ui-token-input id="keywords" on-update="{{_setKeywords}}"></esis-ui-token-input>
  		</div>
      -->

      <div class="form-group">
        <label for="licenseInput" class="col-lg-2 control-label">License: </label>
        <div class="col-lg-10">
          <div style="display:none">Loading...</div>
          <select class="form-control" id="licenseInput"></select>
        </div>
      </div>

      <div class="form-group">
        <label for="organizationInput" class="col-lg-2 control-label">Organization: </label>
        <div class="col-lg-10">
          <div style="display:none">Loading...</div>
          <select class="form-control" id="organizationInput"></select>

          <div class="help-block">
      			To add datasets to an <a href="/organization" target="_blank">organization</a> <a href="/dashboard/organizations" target="_blank">you</a>
            must be a member of the organization with a role of 'editor' or 'admin'.
      		</div>
        </div>
      </div>

      <div class="form-group">
        <label for="visibilityInput" class="col-lg-2 control-label">Visibility: </label>
        <div class="col-lg-10">
          <select class="form-control" id="visibilityInput" disabled>
            <option value="false">Public</option>
    				<option value="true">Private</option>
          </select>

          <div class="help-block" id="visibilityWarnLabel">
            You must select an organization if you wish to set the dataset to private, otherwise the dataset must be public.
      		</div>
        </div>
      </div>

      <!-- Version -->
      <div class="form-group">
        <label for="versionInput" class="col-lg-2 control-label">Version</label>
        <div class="col-lg-10">
          <input type="text" class="form-control" id="versionInput" on-change="onVersionInputChange">
        </div>
      </div>

      <!-- Website -->
      <div class="form-group">
        <label for="websiteInput" class="col-lg-2 control-label">Website</label>
        <div class="col-lg-10">
          <input type="text" class="form-control" id="websiteInput" on-change="onWebsiteInputChange">
        </div>
      </div>

      <h4 class="page-header">Citation</h4>

      <div class="row">
        <div class="col-md-6">
          <!-- Author -->
          <div class="form-group">
            <label for="authorInput" class="col-lg-3 control-label">Author</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="authorInput" on-change="onAuthorInputChange">
            </div>
          </div>

        </div>
        <div class="col-md-6">
          <!-- Author Email -->
          <div class="form-group">
            <label for="authorInputEmail" class="col-lg-3 control-label">Author Email</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="authorInputEmail" on-change="onAuthorInputEmailChange">
            </div>
          </div>

        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <!-- Maintainer -->
          <div class="form-group">
            <label for="maintainerInput" class="col-lg-3 control-label">Maintainer</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="maintainerInput" on-change="onMaintainerInputChange">
            </div>
          </div>

        </div>
        <div class="col-md-6">
          <!-- Maintainer Email -->
          <div class="form-group">
            <label for="maintainerEmailInput" class="col-lg-3 control-label">Maintainer Email</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="maintainerEmailInput" on-change="onMaintainerEmailInputChange">
            </div>
          </div>

        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <!-- Citation -->
          <div class="form-group">
            <label for="citationInput" class="col-lg-3 control-label">Citation</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="citationInput" on-change="onCitationInputChange">
            </div>
          </div>

        </div>
        <div class="col-md-6">
          <!-- Citation DOI -->
          <div class="form-group">
            <label for="citationDOIInput" class="col-lg-3 control-label">Citation DOI</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="citationDOIInput" on-change="onCitationDOIInputChange">
            </div>
          </div>

        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <!-- Funding Source -->
          <div class="form-group">
            <label for="fundingSourceInput" class="col-lg-3 control-label">Funding Source</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="fundingSourceInput" on-change="onFundingSourceInputChange">
            </div>
          </div>

        </div>
        <div class="col-md-6">
          <!-- Funding Source Grant Number -->
          <div class="form-group">
            <label for="fundingSourceNumberInput" class="col-lg-3 control-label">Funding Source Grant Number</label>
            <div class="col-lg-9">
              <input type="text" class="form-control" id="fundingSourceNumberInput" on-change="onFundingSourceNumberInputChange">
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Create Dataset -->
		<a id="createDatasetBtn" class="btn btn-primary" style="display:none">Create Dataset</a>
    <div id="createDatasetLabel" style="display:none" class="alert alert-info">
      <i class="fa fa-spinner fa-spin"></i> Creating Dataset...
    </div>

    <div id="editModeFooter" style="display:none">
      Now <a href="#add-resources">add resources</a> to your dataset. <br />

      <a id="createDatasetBtn" class="btn btn-danger"><i class="fa fa-trash"></i> Delete Dataset</a>
    </div>

		<div class="bugs">
		    Found a bug?  Have an issue?  Let us know <a href="https://github.com/CSTARS/ckanext-esis/issues" target="_blank">here!</a>
		</div>

		<div class="gitInfo" style="display:none">
			<div><b>Branch:</b> <span id="gitBranchLabel"></span></div>
			<div><b>Version:</b> <span id="gitVersionLabel"></span></div>
			<div><b>Commit:</b> <span id="gitCommitLabel"></span></div>
		</div>

  </template>
</dom-module>

<script>
  Polymer({
    is : 'ecosis-page-basic-info',

    ready : function() {
      if( ecosis.user ) this.setUsername();
      else ecosis.on('user-load', this.setUsername.bind(this));

      if( ecosis.ds.editMode ) {
        this.setMode('edit');
        if( ecosis.ds.loaded ) this.onDataLoad();
        else ecosis.ds.on('load', this.onDataLoad.bind(this));
      } else {
        this.setMode('create');
      }
    },

    setMode : function() {
      // TODO
    },

    onDataLoad : function() {
      this.$.titleInput.value = ecosis.ds.data.title;
    },

    setUsername : function() {
      if( !ecosis.user ) return alert("You are not logged in :(");

      this.$.usernameLabel.innerText = ecosis.user.username;
    }
  })
</script>
